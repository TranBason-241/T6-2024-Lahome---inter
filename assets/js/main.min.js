$(document).ready(function () {
  //Change Page
  btnViewMainContent = document.querySelector(".btn-click-to-detail");
  cover = document.querySelector(".cover");
  mainContent = document.querySelector(".main-content");
  btnViewMainContent.addEventListener("click", () => {
    cover.classList.remove("show");
    mainContent.classList.add("show");

    resetAos(1);
  });

  resetAos = (index) => {
    console.log("reset AOS");
    console.log(index);
    elementHasRefrestAos = document.querySelectorAll(`.page-${index} .aos-animate`);
    elementHasRefrestAos.forEach((aos) => {
      aos.classList.remove("aos-animate");
    });
    setTimeout(() => {
      AOS.refreshHard();
    }, 500);
    setTimeout(() => {
      runAnimate(`page-${index}`);
      console.log(`page-${index}`);
    }, 1000);
  };

  runAnimate = (pageClassName) => {
    targetPage = document.querySelector(`.${pageClassName}`);
    listAnimateEle = targetPage.querySelectorAll("[data-aos]");
    listAnimateEle.forEach((element) => {
      element.classList.add("aos-animate");
    });
  };

  ///Change Page

  // changePage = (targetPageId) => {
  //   currentPage = document.querySelector(".page.page-show");
  //   targetPage = document.querySelector(`.page-${targetPageId}`);
  //   // Hide current page
  //   currentPage.classList.remove("page-show");
  //   // currentPage.classList.remove("my-fade-in");
  //   // show target page
  //   targetPage.classList.add("page-show");
  //   // targetPage.classList.add("my-fade-in");
  // };

  // var targetNav;

  // Nav click
  listNavItems = document.querySelectorAll(".nav-item");
  listNavItems.forEach((navItem) => {
    navItem.addEventListener("click", function (event) {
      //Chage Nav active
      targetNav = event.target;
      currentNav = document.querySelector(".active-nav");

      if (!targetNav.classList.contains("nav-item")) {
        targetNav = targetNav.closest(".nav-item");
      }

      targetIndexSlide = targetNav.getAttribute("value") - 1;
      if (targetIndexSlide >= 0) {
        if (currentNav != targetNav) {
          currentNav.classList.remove("active-nav");
          targetNav.classList.add("active-nav");
          // targetPageId = targetNav.getAttribute("value");
          console.log(targetIndexSlide);
          mainSwiper.slideTo(targetIndexSlide);
        }
      } else {
        cover = document.querySelector(".cover");
        mainContent = document.querySelector(".main-content");
        cover.classList.add("show");
        mainContent.classList.remove("show");
      }
    });
  });

  //Mian swiper

  var mainSwiper = new Swiper(".mySwiper", {
    direction: "vertical",
    speed: 800,
    mousewheel: true,
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
      // renderBullet: function (index, className) {
      //   return '<span class="' + className + '">' + (index + 1) + "</span>";
      // },
    },
    on: {
      slideChange: function () {
        valueToFind = this.activeIndex + 1;
        var selector = '.nav-item[value="' + valueToFind + '"]';
        var targetNav = document.querySelector(selector);
        currentNav = document.querySelector(".active-nav");
        currentNav.classList.remove("active-nav");
        targetNav.classList.add("active-nav");
        resetAos(valueToFind);
      },
    },
    initialSlide: 0,
  });

  // Thêm bộ lắng nghe sự kiện 'wheel' vào phần tử
  // readyChange = true;
  // window.addEventListener("wheel", function (event) {
  //   if (readyChange) {
  //     readyChange = false;
  //     currentNav = document.querySelector(".active-nav");
  //     if (event.deltaY < 0) {
  //       console.log("Lăn chuột lên");
  //       if (currentNav.getAttribute("value") > 1) {
  //         currentNav.previousElementSibling.click();
  //       } else {
  //         console.log("is page 1");
  //       }
  //     } else if (event.deltaY > 0) {
  //       console.log("Lăn chuột xuống");
  //       if (currentNav.getAttribute("value") < 6) {
  //         currentNav.nextElementSibling.click();
  //       } else {
  //         console.log("is last");
  //       }
  //     }
  //     setTimeout(() => {
  //       readyChange = true;
  //     }, 500);
  //   }
  // });

  //// Modal type 1

  ///Fake div map

  fakeDivs = document.querySelectorAll(".fake-div");
  fakeDivs.forEach((fakeDiv) => {
    fakeDiv.addEventListener("mouseover", () => {
      markDiv = fakeDiv.previousElementSibling;
      textDiv = fakeDiv.nextElementSibling;
      textDiv.classList.add("show-item");
      markDiv.classList.add("show-item");
    });

    fakeDiv.addEventListener("mouseout", () => {
      markDiv = fakeDiv.previousElementSibling;
      textDiv = fakeDiv.nextElementSibling;
      textDiv.classList.remove("show-item");
      markDiv.classList.remove("show-item");
    });

    fakeDiv.addEventListener("click", () => {
      showModal(event.target);
    });
  });
  var slide_for_page_3;
  var slide_for_page_5;
  var myModalType_1 = new bootstrap.Modal(document.getElementById("modal-type-1"), {});

  $("#modal-type-1").on("hidden.bs.modal", function (e) {
    console.log("Modal is closed");
    // slide_for_page_3.destroy();
  });

  showModal = (markClick) => {
    //Check là của page nào. Vì có 2 page dùng type slide này
    // sau đó check active sldie nai

    slideIndex = parseInt(markClick.getAttribute("indexSlide"), 10);
    // slideIndex = slideIndex - 1;
    console.log(slideIndex);
    myModalType_1.show();
    targetSlide = markClick.closest(".page");
    // console.log(targetSlide.getAttribute("id"));
    if (targetSlide.getAttribute("id") == "p-3") {
      //Ẩn slide đang show
      CurrentSlideShow = document.querySelector(".slide-type-1-container.show");
      if (CurrentSlideShow) {
        CurrentSlideShow.classList.remove("show");
      }
      //show target page
      targetSlideShow = document.querySelector('[forPage="3"]');
      targetSlideShow.classList.add("show");

      if (!slide_for_page_3) {
        setTimeout(() => {
          slide_for_page_3 = new Swiper(".slide-page-3 .swiper-type-1", {
            slidesPerView: 1,
            spaceBetween: 30,
            loop: false,
            effect: "fade",
            pagination: {
              el: ".slide-page-3 .swiper-pagination",
              // clickable: true,
            },
            navigation: {
              nextEl: ".slide-page-3 .swiper-button-next",
              prevEl: ".slide-page-3 .swiper-button-prev",
            },
            // initialSlide: slideIndex,
          });
        }, 300);
      }
      setTimeout(() => {
        slide_for_page_3.slideTo(slideIndex);
      }, 300);
    } else if (targetSlide.getAttribute("id") == "p-5") {
      //Ẩn slide đang show
      CurrentSlideShow = document.querySelector(".slide-type-1-container.show");
      if (CurrentSlideShow) {
        CurrentSlideShow.classList.remove("show");
      }
      //show target page
      targetSlideShow = document.querySelector('[forPage="5"]');
      targetSlideShow.classList.add("show");

      if (!slide_for_page_5) {
        setTimeout(() => {
          slide_for_page_5 = new Swiper(".slide-page-5 .swiper-type-1", {
            slidesPerView: 1,
            spaceBetween: 30,
            effect: "fade",
            loop: false,
            pagination: {
              el: ".slide-page-5 .swiper-pagination",
              clickable: true,
            },
            navigation: {
              nextEl: ".slide-page-5 .swiper-button-next",
              prevEl: ".slide-page-5 .swiper-button-prev",
            },
          });
        }, 300);
      }
      setTimeout(() => {
        slide_for_page_5.slideTo(slideIndex);
      }, 500);
    }
  };

  /////modal Type 2

  var myModalType_2 = new bootstrap.Modal(document.getElementById("modal-type-2"), {});

  var slide_for_page_7;

  showModalType_2 = (element) => {
    console.log(element);
    slideIndex = parseInt(element.getAttribute("indexSlide"), 10);
    console.log(slideIndex);
    myModalType_2.show();
    if (!slide_for_page_7) {
      setTimeout(() => {
        slide_for_page_7 = new Swiper(".slide-page-7 .swiper-type-2", {
          slidesPerView: 1,
          spaceBetween: 30,
          loop: false,
          effect: "fade",
          pagination: {
            el: ".slide-page-7 .swiper-pagination",
            // clickable: true,
          },
          navigation: {
            nextEl: ".slide-page-7 .swiper-button-next",
            prevEl: ".slide-page-7 .swiper-button-prev",
          },
          // initialSlide: slideIndex,
        });
      }, 300);
    }
    setTimeout(() => {
      slide_for_page_7.slideTo(slideIndex);
    }, 300);
  };

  flags = document.querySelectorAll(".flag");
  flags.forEach((flag) => {
    flag.addEventListener("mouseover", () => {
      img = flag.nextElementSibling;
      img.classList.add("show-item");
    });

    flag.addEventListener("mouseout", () => {
      img = flag.nextElementSibling;
      img.classList.remove("show-item");
    });

    flag.addEventListener("click", () => {
      targetParent = event.target;
      if (!targetParent.classList.contains("flag")) {
        targetParent = targetParent.closest(".flag");
      }
      showModalType_2(targetParent);
    });
  });
});

// write function convert string to number

// write function change background when click on button has id = "haha"
